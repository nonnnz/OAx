FROM oven/bun:latest

WORKDIR /app

COPY package*.json ./
RUN bun install

# Copy the rest of the application
COPY . .

# Environment variables
ARG DATABASE_URL
ENV DATABASE_URL=${DATABASE_URL}
ARG PORT
ENV PORT=${PORT}
ARG GEMINI_API_KEY
ENV GEMINI_API_KEY=${GEMINI_API_KEY}
ARG OPENROUTER_API_KEY
ENV OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
ARG BACKEND_URL
ENV BACKEND_URL=${BACKEND_URL}
ARG REDIS_PASSWORD
ENV REDIS_PASSWORD=${REDIS_PASSWORD}
ARG BACKEND_PUBLIC_URL
ENV BACKEND_PUBLIC_URL=${BACKEND_PUBLIC_URL}
ARG OPEN_SLIP_VERIFY_TOKEN
ENV OPEN_SLIP_VERIFY_TOKEN=${OPEN_SLIP_VERIFY_TOKEN}
ARG FRONTEND_URL
ENV FRONTEND_URL=${FRONTEND_URL}
ARG REDIS_URL
ENV REDIS_URL=${REDIS_URL}
ARG REDIS_HOST
ENV REDIS_HOST=${REDIS_HOST}
ARG REDIS_PORT
ENV REDIS_PORT=${REDIS_PORT}
ARG CLOUD_RUN_OLLAMA_URL
ENV CLOUD_RUN_OLLAMA_URL=${CLOUD_RUN_OLLAMA_URL}

# Generate Prisma client
RUN bun x prisma generate

# Expose the port Elysia runs on
EXPOSE 3000

# Start the application
CMD ["bun", "run", "dev"]